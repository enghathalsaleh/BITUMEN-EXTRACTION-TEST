<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        body { font-family: 'Cairo', sans-serif; }
        
        .print-only { display: none; }
        
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { 
                -webkit-print-color-adjust: exact; 
                color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .print-table {
                font-size: 10px !important;
                width: 100% !important;
            }
            
            .print-table th,
            .print-table td {
                padding: 4px 2px !important;
                border: 1px solid #00685E !important;
                white-space: nowrap !important;
            }
            
            .print-table th {
                background-color: #00685E !important;
                color: white !important;
                font-weight: bold !important;
            }
            
            .print-table tbody tr:nth-child(even) {
                background-color: #f8fffe !important;
            }
            
            @page {
                size: A4 landscape;
                margin: 1cm;
            }
        }

        .custom-input {
            border: 2px solid #8BAA99;
            transition: all 0.3s ease;
        }
        
        .custom-input:focus {
            border-color: #00685E;
            box-shadow: 0 0 0 3px rgba(0, 104, 94, 0.1);
        }
        
        .dark .custom-input {
            border-color: #8BAA99;
            background-color: #101820;
            color: #f9fafb;
        }
        
        .dark .custom-input:focus {
            border-color: #00A399;
            box-shadow: 0 0 0 3px rgba(0, 163, 153, 0.2);
        }
        
        .brand-gradient {
            background: linear-gradient(135deg, #00685E 0%, #8BAA99 100%);
        }
        
        .brand-card {
            background: linear-gradient(145deg, rgba(139, 170, 153, 0.1) 0%, rgba(0, 104, 94, 0.05) 100%);
            border: 1px solid rgba(139, 170, 153, 0.2);
        }
        
        .dark .brand-card {
            background: linear-gradient(145deg, rgba(0, 163, 153, 0.1) 0%, rgba(139, 170, 153, 0.05) 100%);
            border: 1px solid rgba(0, 163, 153, 0.2);
        }
        
        .accent-orange { color: #E59256; }
        .accent-gold { color: #F2C75C; }
        .accent-blue { color: #006797; }
        .accent-teal { color: #00A399; }
        .accent-brown { color: #B98346; }
        .accent-red { color: #A13525; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                    },
                    colors: {
                        primary: '#00685E',
                        secondary: '#8BAA99',
                        dark: '#101820',
                        accent: {
                            gold: '#F2C75C',
                            orange: '#E59256',
                            red: '#A13525',
                            blue: '#006797',
                            teal: '#00A399',
                            brown: '#B98346'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-cairo">

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8 no-print">
            <div class="brand-gradient text-white py-8 px-6 rounded-xl shadow-2xl mb-6">
                <h1 class="text-4xl font-bold mb-2">BITUMEN EXTRACTION TEST</h1>
                <h2 class="text-2xl font-semibold opacity-90">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ†</h2>
                <div class="mt-4 flex justify-center space-x-2">
                    <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                    <div class="w-3 h-3 rounded-full bg-orange-400"></div>
                    <div class="w-3 h-3 rounded-full bg-blue-400"></div>
                </div>
            </div>
        </div>

        <!-- Project Information -->
        <div class="brand-card rounded-lg p-6 mb-8 shadow-lg">
            <h3 class="text-xl font-semibold mb-4 text-primary flex items-center">
                <span class="w-2 h-6 bg-primary rounded-full ml-2"></span>
                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="projectName" class="w-full px-3 py-2 text-base rounded-lg custom-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label>
                    <input type="text" id="contractorName" class="w-full px-3 py-2 text-base rounded-lg custom-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©</label>
                    <select id="layerType" class="w-full px-3 py-2 text-base rounded-lg custom-input">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©</option>
                        <option value="B.W.C">B.W.C</option>
                        <option value="B.B.C">B.B.C</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                    <input type="date" id="testDate" class="w-full px-3 py-2 text-base rounded-lg custom-input">
                </div>
            </div>
        </div>

        <!-- Sample Input Form -->
        <div class="brand-card rounded-lg p-6 mb-8 shadow-lg no-print">
            <h3 class="text-xl font-semibold mb-4 text-primary flex items-center">
                <span class="w-2 h-6 bg-accent-teal rounded-full ml-2"></span>
                Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</label>
                    <input type="text" id="sampleName" class="w-full px-3 py-2 text-base rounded-lg custom-input" placeholder="Ù…Ø«Ø§Ù„: Ø¹ÙŠÙ†Ø©-1">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¬Ø±Ø§Ù…)</label>
                    <input type="number" id="sampleWeightBefore" class="w-full px-3 py-2 text-base rounded-lg custom-input" step="0.01" placeholder="0.00">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¬Ø±Ø§Ù…)</label>
                    <input type="number" id="filterWeightBefore" class="w-full px-3 py-2 text-base rounded-lg custom-input" step="0.01" placeholder="0.00">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¬Ø±Ø§Ù…)</label>
                    <input type="number" id="sampleWeightAfter" class="w-full px-3 py-2 text-base rounded-lg custom-input" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¬Ø±Ø§Ù…)</label>
                    <input type="number" id="filterWeightAfter" class="w-full px-3 py-2 text-base rounded-lg custom-input" step="0.01" placeholder="0.00">
                </div>
                <div class="flex items-end">
                    <button onclick="addSample()" class="w-full brand-gradient hover:opacity-90 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 shadow-lg">
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹ÙŠÙ†Ø©
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
            <div class="px-6 py-4 brand-gradient text-white">
                <h3 class="text-xl font-semibold flex items-center">
                    <span class="w-2 h-6 bg-white rounded-full ml-2 opacity-80"></span>
                    Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                </h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full print-table">
                    <thead class="bg-secondary text-white">
                        <tr>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">#</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ù‚Ø¨Ù„ (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ù‚Ø¨Ù„ (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ø¨Ø¹Ø¯ (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ø¨Ø¹Ø¯ (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„ØªØ±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ„ØªØ± (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300">ÙˆØ²Ù† Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ† (Ø¬Ù…)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300 accent-gold">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ† (%)</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold border border-gray-300 no-print">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable" class="divide-y divide-gray-200 dark:divide-gray-600">
                        <tr>
                            <td colspan="11" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠÙ†Ø§Øª Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex flex-wrap gap-4 justify-center no-print">
            <button onclick="printResults()" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 shadow-lg flex items-center">
                <span class="ml-2">ğŸ“„</span>
                Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            </button>
            <button onclick="exportToExcel()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 shadow-lg flex items-center">
                <span class="ml-2">ğŸ“Š</span>
                ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
            </button>
            <button onclick="clearAll()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 shadow-lg flex items-center">
                <span class="ml-2">ğŸ—‘ï¸</span>
                Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>

        <!-- Print Header (only visible when printing) -->
        <div class="print-only text-center mb-8 border-b-4 border-primary pb-6">
            <div class="bg-gradient-to-r from-primary to-secondary text-white py-6 px-8 rounded-lg mb-4">
                <h1 class="text-3xl font-bold mb-2">BITUMEN EXTRACTION TEST</h1>
                <h2 class="text-xl font-semibold opacity-90">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ†</h2>
            </div>
            <div class="text-sm mb-4 grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
                <div class="text-right">
                    <p><strong class="text-primary">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> <span id="printProjectName" class="text-gray-700"></span></p>
                    <p><strong class="text-primary">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„:</strong> <span id="printContractorName" class="text-gray-700"></span></p>
                </div>
                <div class="text-right">
                    <p><strong class="text-primary">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©:</strong> <span id="printLayerType" class="text-gray-700"></span></p>
                    <p><strong class="text-primary">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong> <span id="printTestDate" class="text-gray-700"></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Confirmations -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <p id="confirmMessage" class="text-gray-700 dark:text-gray-300 mb-4"></p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeConfirmModal()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Ø¥Ù„ØºØ§Ø¡</button>
                <button id="confirmButton" onclick="confirmAction()" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        let samples = [];
        let confirmCallback = null;

        function showConfirmDialog(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            confirmCallback = callback;
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            confirmCallback = null;
        }

        function confirmAction() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        }

        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded">Ù…ÙˆØ§ÙÙ‚</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function addSample() {
            const sampleName = document.getElementById('sampleName').value.trim();
            const sampleWeightBefore = parseFloat(document.getElementById('sampleWeightBefore').value);
            const filterWeightBefore = parseFloat(document.getElementById('filterWeightBefore').value);
            const sampleWeightAfter = parseFloat(document.getElementById('sampleWeightAfter').value);
            const filterWeightAfter = parseFloat(document.getElementById('filterWeightAfter').value);

            // Validation
            if (!sampleName) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©');
                return;
            }

            if (samples.length >= 50) {
                showAlert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† 50 Ø¹ÙŠÙ†Ø©');
                return;
            }

            if (samples.some(sample => sample.name === sampleName)) {
                showAlert('Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø© Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }

            if (isNaN(sampleWeightBefore) || isNaN(filterWeightBefore) || 
                isNaN(sampleWeightAfter) || isNaN(filterWeightAfter)) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                return;
            }

            if (sampleWeightBefore <= 0 || filterWeightBefore < 0 || 
                sampleWeightAfter < 0 || filterWeightAfter < 0) {
                showAlert('Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù… Ù…ÙˆØ¬Ø¨Ø©');
                return;
            }

            // Calculations
            const soilOnFilter = filterWeightAfter - filterWeightBefore;
            const totalSampleWeightAfter = sampleWeightAfter + soilOnFilter;
            const bitumenWeight = sampleWeightBefore - totalSampleWeightAfter;
            const bitumenPercentage = (bitumenWeight / sampleWeightBefore) * 100;

            const sample = {
                name: sampleName,
                sampleWeightBefore,
                filterWeightBefore,
                sampleWeightAfter,
                filterWeightAfter,
                soilOnFilter,
                totalSampleWeightAfter,
                bitumenWeight,
                bitumenPercentage
            };

            samples.push(sample);
            
            // Clear form
            document.getElementById('sampleName').value = '';
            document.getElementById('sampleWeightBefore').value = '';
            document.getElementById('filterWeightBefore').value = '';
            document.getElementById('sampleWeightAfter').value = '';
            document.getElementById('filterWeightAfter').value = '';

            // Auto-generate next sample name
            const nextSampleNumber = samples.length + 1;
            document.getElementById('sampleName').value = `Ø¹ÙŠÙ†Ø©-${nextSampleNumber}`;

            updateResultsTable();
        }

        function updateResultsTable() {
            const tbody = document.getElementById('resultsTable');
            
            if (samples.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠÙ†Ø§Øª Ø¨Ø¹Ø¯. Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = samples.map((sample, index) => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 ${index % 2 === 0 ? 'bg-gray-25' : ''}">
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-medium">${index + 1}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 font-medium accent-teal">${sample.name}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${sample.sampleWeightBefore.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${sample.filterWeightBefore.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${sample.sampleWeightAfter.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${sample.filterWeightAfter.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center accent-blue">${sample.soilOnFilter.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center accent-brown">${sample.totalSampleWeightAfter.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center accent-orange">${sample.bitumenWeight.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-bold accent-gold text-lg">${sample.bitumenPercentage.toFixed(2)}%</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 no-print text-center">
                        <button onclick="deleteSample(${index})" class="text-red-600 hover:text-red-800 text-xs bg-red-50 px-2 py-1 rounded">
                            ğŸ—‘ï¸
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteSample(index) {
            showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹ÙŠÙ†Ø©ØŸ', () => {
                samples.splice(index, 1);
                updateResultsTable();
            });
        }

        function printResults() {
            if (samples.length === 0) {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
                return;
            }

            // Update print header with project info
            document.getElementById('printProjectName').textContent = document.getElementById('projectName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('printContractorName').textContent = document.getElementById('contractorName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('printLayerType').textContent = document.getElementById('layerType').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('printTestDate').textContent = document.getElementById('testDate').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            window.print();
        }

        function exportToExcel() {
            if (samples.length === 0) {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }

            const projectInfo = [
                ['Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', document.getElementById('projectName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'],
                ['Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„', document.getElementById('contractorName').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'],
                ['Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©', document.getElementById('layerType').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'],
                ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', document.getElementById('testDate').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'],
                [''],
                ['BITUMEN EXTRACTION TEST - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ†'],
                ['']
            ];

            const headers = [
                '#', 'Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©', 'ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ù‚Ø¨Ù„ (Ø¬Ù…)', 'ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ù‚Ø¨Ù„ (Ø¬Ù…)',
                'ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ø¨Ø¹Ø¯ (Ø¬Ù…)', 'ÙˆØ²Ù† Ø§Ù„ÙÙ„ØªØ± Ø¨Ø¹Ø¯ (Ø¬Ù…)', 'ÙˆØ²Ù† Ø§Ù„ØªØ±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙÙ„ØªØ± (Ø¬Ù…)',
                'ÙˆØ²Ù† Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ (Ø¬Ù…)', 'ÙˆØ²Ù† Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ† (Ø¬Ù…)', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨ÙŠØªÙˆÙ…ÙŠÙ† (%)'
            ];

            const data = samples.map((sample, index) => [
                index + 1,
                sample.name,
                sample.sampleWeightBefore.toFixed(2),
                sample.filterWeightBefore.toFixed(2),
                sample.sampleWeightAfter.toFixed(2),
                sample.filterWeightAfter.toFixed(2),
                sample.soilOnFilter.toFixed(2),
                sample.totalSampleWeightAfter.toFixed(2),
                sample.bitumenWeight.toFixed(2),
                sample.bitumenPercentage.toFixed(2) + '%'
            ]);

            const wsData = [...projectInfo, headers, ...data];
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Bitumen Test Results');

            // Add some styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let R = 0; R <= range.e.r; ++R) {
                for (let C = 0; C <= range.e.c; ++C) {
                    const cell_address = XLSX.utils.encode_cell({c: C, r: R});
                    if (!ws[cell_address]) continue;
                    
                    if (R === projectInfo.length - 1) { // Headers row
                        ws[cell_address].s = {
                            font: { bold: true },
                            fill: { fgColor: { rgb: "5D5CDE" } },
                            color: { rgb: "FFFFFF" }
                        };
                    }
                }
            }

            const fileName = `Bitumen_Test_Results_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function clearAll() {
            if (samples.length === 0) {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³Ø­');
                return;
            }

            showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.', () => {
                samples = [];
                updateResultsTable();
                
                // Clear project info
                document.getElementById('projectName').value = '';
                document.getElementById('contractorName').value = '';
                document.getElementById('layerType').value = '';
                document.getElementById('testDate').value = '';
                
                // Clear sample form
                document.getElementById('sampleName').value = 'Ø¹ÙŠÙ†Ø©-1';
                document.getElementById('sampleWeightBefore').value = '';
                document.getElementById('filterWeightBefore').value = '';
                document.getElementById('sampleWeightAfter').value = '';
                document.getElementById('filterWeightAfter').value = '';
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('sampleName').value = 'Ø¹ÙŠÙ†Ø©-1';
            document.getElementById('testDate').value = new Date().toISOString().slice(0, 10);
        });
    </script>
</body>
</html>
